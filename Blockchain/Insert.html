
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joining Form</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://demos.creative-tim.com/notus-js/assets/styles/tailwind.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>

    <link rel="stylesheet" href="https://demos.creative-tim.com/notus-js/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css">
</head>
<body>
<section class="py-6 dark:dark:bg-gray-800 dark:dark:text-gray-50">
	<div class="grid max-w-6xl grid-cols-1 px-6 mx-auto lg:px-8 md:grid-cols-2 md:divide-x">
		<div class="py-6 md:py-0 md:px-6"  style="margin: auto 0;">
			<h1 class="text-4xl font-bold" style="font-weight: 600; font-family: 'Space Grotesk', sans-serif;">Store your Data with us...!</h1>
			<h3 class="text-xl font-bold" style="margin-top: 5px; margin-bottom: 15px; font-family: 'Space Grotesk', sans-serif;">Fill out the details to get started</h3>
            <div class="flex md:mt-4 mt-6">
                <p id="accountArea">Connection Status: NOT CONNECTED to Metamask </p>
            </div>
            <div class="flex md:mt-4 mt-6">
                <button onclick="connectMetamask()">Connect</button>
            </div>
            <div class="flex md:mt-4 mt-6">
                <p id="contractArea">Connection Status: NOT CONNECTED to Smart Contract</p>
            </div>
            <div class="flex md:mt-4 mt-6">
                <button onclick="connectContract()">Contract</button>
            </div>
			<div class="space-y-4">
                <p class="flex items-center">
                    <h3 class="text-xl font-bold" style="margin-top: 20px; margin-bottom: 15px; font-family: 'Space Grotesk', sans-serif;">Team Krantiveer got your back...</h3>
                </p>
                <p class="flex items-center">
                    <div class="teams">
                        <img src="person.svg">
                        <div class="teams2">
                            <h3>Sarthak Chauhan</h3>
                            <p>Leader</p>
                            <h4>sarthakchauhan@ieee.org</h4>
                        </div>
                    </div>
                    <div class="teams">
                        <img src="person.svg">
                        <div class="teams2">
                            <h3>Shreshth Sahay</h3>
                            <p>Researcher</p>
                            <h4>shreshthsahay@ieee.org</h4>
                        </div>
                    </div>
                    <div class="teams">
                        <img src="person.svg">
                        <div class="teams2">
                            <h3>Tarun Saroch</h3>
                            <p>Student</p>
                            <h4>tsaroch@proton.me</h4>
                        </div>
                    </div>
                </p>
                
			</div>
		</div>
		<form class="flex flex-col py-6 space-y-6 md:py-0 md:px-6 ng-untouched ng-pristine ng-valid">
			<label class="block">
				<span class="mb-1">Full name</span>
				<input type="text" placeholder="Tim Scott" name="fullname" id="fullname" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800" required>
			</label>
            <div class="divvy">
                <label class="block">
                    <span class="mb-1">Blood Group</span>
                    <select id="bloodgrp" name="bloodgrp" id="bloodgrp" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
                        <option value="">Select</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="other">other</option>
                    </select>
                </label>
                <label class="block ml-10">
                    <span class="mb-1">Gender</span>
                    <select id="gender" name="gender" id="gender" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
                        <option value="">Select</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Other</option>
                    </select>
                </label>
                <label class="block ml-10">
                    <span class="mb-1">Age</span>
                    <input type="text" placeholder="19" name="age" id="age" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
                </label>
            </div>
            <label class="block">
				<span class="mb-1">Email address</span>
				<input type="email" placeholder="your@mail.com" name="email" id="email" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
			</label>
            <label class="block">
				<span class="mb-1">Contact number (Preferably Whatsapp)</span>
				<input type="number" placeholder="+91 - 9055XXXXXXX" name="phone" id="phone" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
			</label>
            <div class="divvy">
                <label class="block w-40">
                    <span class="mb-1">Marital Status</span>
                    <select name="marital" id="marital" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
                        <option value="">Select</option>
                        <option value="S">Single</option>
                        <option value="M">Married</option>
                        <option value="O">Other</option>
                    </select>
                </label>
                <label class="block ml-10 w-full">
                    <span class="mb-1">Health ID Number</span>
                    <input type="text" placeholder="XX-XXXX-XXXX-XXXX" name="ayush" id="ayush" class="block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800">
                </label>
            </div>
            <label class="block">
				<span class="mb-1">Discuss about your Allergies</span>
				<textarea rows="3" id="allergies" name="allergies" placeholder="Like Eggs, Mushroom, etc." class="block w-full rounded-md focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800"></textarea>
			</label>
			<label class="block">
				<span class="mb-1">Past Medication / Prescription</span>
				<textarea rows="5" id="past" name="past" placeholder="Drugs, Medicines, etc." class="block w-full rounded-md focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800" ></textarea>
			</label>
            <label class="block">
				<span class="mb-1">Any Surgeries</span>
				<textarea rows="5" id="surgeries" name="surgeries" placeholder="Like Liver, Kidney, etc." class="block w-full rounded-md focus:ring focus:ring-opacity-75 focus:ring-violet-400 dark:dark:bg-gray-800" ></textarea>
			</label>
			<button id="sub" onclick="changeWord()">Send Data</button>
		</form>
	</div>
</section>
<script>
		let account;
		const connectMetamask = async() => {
			if (window.ethereum !== "undefined") {
				const accounts = await ethereum.request({
					method: "eth_requestAccounts"
				});
				account = accounts[0];
				document.getElementById("accountArea").innerHTML = `Account is: ${account}`;
			}

		}

    const connectContract = async() => {
            const ABI = [
	{
		"inputs": [],
		"name": "getUserData",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "userAddress",
				"type": "address"
			}
		],
		"name": "getUserDataByAddress",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "fullName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "bloodgroup",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "gender",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "phoneNo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "maritalStatus",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "healthid",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "allergies",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "pres",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "surgery",
				"type": "string"
			}
		],
		"name": "storeUserData",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
            const Address = "0xc565B1Bf033FfbD92c41aa73546975de9DFF74Bc";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);
            document.getElementById("contractArea").innerHTML = "connected to smart contract";
        }
    const changeWord = async() => {
        const myEntry1 = document.getElementById("fullname").value;
        const myEntry2 = document.getElementById("bloodgrp").value;
        const myEntry3 = document.getElementById("gender").value;
        const myEntry4 = document.getElementById("age").value;
        const myEntry5 = document.getElementById("email").value;
        const myEntry6 = document.getElementById("phone").value;
        const myEntry7 = document.getElementById("marital").value;
        const myEntry8 = document.getElementById("ayush").value;
        const myEntry9 = document.getElementById("allergies").value;
        const myEntry10 = document.getElementById("past").value;
        const myEntry11 = document.getElementById("surgeries").value;
        await window.contract.methods.storeUserData(myEntry1, myEntry2, myEntry3, myEntry4, myEntry5, myEntry6, myEntry7, myEntry8, myEntry9, myEntry10, myEntry11).send({
            from: account
        });
    }
	const readContract = async() => {
		const userAddress = "USER_ADDRESS";
		let acc = account;
		const userData = await contract.methods.getUserDataByAddress(acc).call();
		const fullname = userData[0];
		const bloodgrp = userData[1];
		const gender = userData[2];
		const age = userData[3];
		const email = userData[4];
		const phone = userData[5];
		const marital = userData[6];
		const ayush = userData[7];
		const allergies = userData[8];
		const past = userData[9];
		const surgeries = userData[10];
		const data = `Full Name: ${fullName}<br>
						Blood Group: ${bloodgrp}<br>
						Gender: ${gender}<br>
						Age: ${age}<br>
						Email: ${email}<br>
						Phone: ${phone}<br>
						Marital: ${marital}<br>
						Ayush: ${ayush}<br>
						Allergies: ${allergies}<br>
						Past Medical History: ${past}<br>
						Surgeries: ${surgeries}`;
		console.log(data);
	}

const form = document.querySelector('form');
const submitBtn = document.getElementById('sub');

submitBtn.addEventListener('click', (event) => {
  event.preventDefault(); // Prevent form submission
});

</script>
</body>
</html>